(function(){var twb,originalT=window.T;twb={_name:"Tencent weibo SDK",_appkey:"{APPKEY}",_appkeyVerified:"{APPKEY_VERIFIED}"==="verified",_debug:true,_domain:{api:"{API_URI}",cdn:"{CDN_URI}",auth:"{AUTH_URI}",exchange:"{EXCHANGE_TOKEN_URI}",query:"{QUERY_TOKEN_URI}",clientproxy:"{CLIENTPROXY_URI}",serverproxy:"{SERVERPROXY_URI}",flashproxy:"{FLASHPROXY_URI}"},_cookie:{names:{accessToken:"QQWBToken",refreshToken:"QQWBRefreshToken"},path:"/",domain:""},noConflict:function(){originalT&&(window.T=originalT);return twb},copy:function(target,source,overwrite,transform){for(var key in source){if(overwrite||typeof target[key]==="undefined"){target[key]=transform?transform(source[key]):source[key]}}return target},create:function(name,value){var node=this,nameParts=name?name.split("."):[],c=nameParts.length;for(var i=0;i<c;i++){var part=nameParts[i],nso=node[part];if(!nso){nso=(value&&i+1===c)?value:{};node[part]=nso}node=nso}return node},extend:function(target,source,overwrite){return twb.copy(typeof target==='string'?twb.create.call(this,target):target,source,overwrite)},_alias:function(alias,origin){origin=origin||twb;if(typeof alias==='string'){this[alias]=origin}else if(Object.prototype.toString.call(alias)==="[object Array]"){for(var i=0,l=alias.length;i<l;i++){this[alias[i]]=origin}}},alias:function(alias,origin){twb._alias(alias,twb[origin])},assign:function(name,key,value){var node=this,lastNode=node,nameParts=name?name.split("."):[],c=nameParts.length;for(var i=0;i<c;i++){var part=nameParts[i],nso=node[part];if(!nso){throw new Error("Tencent weibo SDK: [ERROR] no such name "+part)}lastNode=node;node=nso}if(typeof node==="string"){lastNode[part]=node.replace(new RegExp("\\{"+key+"\\}","ig"),value)}else if(typeof node==="object"){for(var prop in node){if(node.hasOwnProperty(prop)&&typeof node[prop]==="string"){node[prop]=node[prop].replace(new RegExp("\\{"+key+"\\}","ig"),value)}}}},uid:function(){return Math.random().toString(16).substr(2)}};twb.alias('provide','create');twb._alias.call(window,["QQWB","T"],twb);twb.assign("_domain","API_URI","http://test.svr.net/apphost/oauth/api.php");twb.assign("_domain","AUTH_URI","http://open.t.qq.com/oauth_html/login2test.php");twb.assign("_domain","EXCHANGE_TOKEN_URI","http://test.svr.net/apphost/oauth/exchangeToken.php");twb.assign("_domain","QUERY_TOKEN_URI","http://test.svr.net/apphost/oauth/queryToken.php");twb.assign("_domain","SERVERPROXY_URI","http://open.t.qq.com/media/proxy.html");twb.assign("_domain","FLASHPROXY_URI","http://open.t.qq.com/media/proxy.swf")}());(function(){var sprintf=(function(){function get_type(variable){return Object.prototype.toString.call(variable).slice(8,-1).toLowerCase()}function str_repeat(input,multiplier){for(var output=[];multiplier>0;output[--multiplier]=input){}return output.join('')}var str_format=function(){if(!str_format.cache.hasOwnProperty(arguments[0])){str_format.cache[arguments[0]]=str_format.parse(arguments[0])}return str_format.format.call(null,str_format.cache[arguments[0]],arguments)};str_format.format=function(parse_tree,argv){var cursor=1,tree_length=parse_tree.length,node_type='',arg,output=[],i,k,match,pad,pad_character,pad_length;for(i=0;i<tree_length;i++){node_type=get_type(parse_tree[i]);if(node_type==='string'){output.push(parse_tree[i])}else if(node_type==='array'){match=parse_tree[i];if(match[2]){arg=argv[cursor];for(k=0;k<match[2].length;k++){if(!arg.hasOwnProperty(match[2][k])){throw(sprintf('[sprintf] property "%s" does not exist',match[2][k]))}arg=arg[match[2][k]]}}else if(match[1]){arg=argv[match[1]]}else{arg=argv[cursor++]}if(/[^s]/.test(match[8])&&(get_type(arg)!='number')){throw(sprintf('[sprintf] expecting number but found %s',get_type(arg)))}switch(match[8]){case'b':arg=arg.toString(2);break;case'c':arg=String.fromCharCode(arg);break;case'd':arg=parseInt(arg,10);break;case'e':arg=match[7]?arg.toExponential(match[7]):arg.toExponential();break;case'f':arg=match[7]?parseFloat(arg).toFixed(match[7]):parseFloat(arg);break;case'o':arg=arg.toString(8);break;case's':arg=((arg=arg?String(arg):"")&&match[7]?arg.substring(0,match[7]):arg);break;case'u':arg=Math.abs(arg);break;case'x':arg=arg.toString(16);break;case'X':arg=arg.toString(16).toUpperCase();break}arg=(/[def]/.test(match[8])&&match[3]&&arg>=0?'+'+arg:arg);pad_character=match[4]?match[4]=='0'?'0':match[4].charAt(1):' ';pad_length=match[6]-String(arg).length;pad=match[6]?str_repeat(pad_character,pad_length):'';output.push(match[5]?arg+pad:pad+arg)}}return output.join('')};str_format.cache={};str_format.parse=function(fmt){var _fmt=fmt,match=[],parse_tree=[],arg_names=0;while(_fmt){if((match=/^[^\x25]+/.exec(_fmt))!==null){parse_tree.push(match[0])}else if((match=/^\x25{2}/.exec(_fmt))!==null){parse_tree.push('%')}else if((match=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(_fmt))!==null){if(match[2]){arg_names|=1;var field_list=[],replacement_field=match[2],field_match=[];if((field_match=/^([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null){field_list.push(field_match[1]);while((replacement_field=replacement_field.substring(field_match[0].length))!==''){if((field_match=/^\.([a-z_][a-z_\d]*)/i.exec(replacement_field))!==null){field_list.push(field_match[1])}else if((field_match=/^\[(\d+)\]/.exec(replacement_field))!==null){field_list.push(field_match[1])}else{throw('[sprintf] huh?')}}}else{throw('[sprintf] huh?')}match[2]=field_list}else{arg_names|=2}if(arg_names===3){throw('[sprintf] mixing positional and named placeholders is not (yet) supported')}parse_tree.push(match)}else{throw('[sprintf] huh?')}_fmt=_fmt.substring(match[0].length)}return parse_tree};return str_format})();var vsprintf=function(fmt,argv){argv.unshift(fmt);return sprintf.apply(null,argv)};QQWB.extend("format",{sprintf:sprintf,vsprintf:vsprintf})}());QQWB.extend("time",{now:function(){return+this.dateNow()},secondsNow:function(){return Math.round(this.now()/1000)},dateNow:function(){return new Date},shortTime:function(date,format){if(!(date instanceof Date)){format=date;date=this.dateNow()}format=format||"%(year)s/%(month)s/%(day)s %(hour)02d:%(minute)02d:%(second)02d";return QQWB.format.sprintf(format,{year:date.getFullYear(),month:date.getMonth(),day:date.getDate(),hour:date.getHours(),minute:date.getMinutes(),second:date.getSeconds()})}});QQWB.extend("log",{CRITICAL:50,ERROR:40,WARNING:30,INFO:20,DEBUG:10,NOTSET:0,_level:0,_format:"%(frame)s%(name)s: [%(levelname)s] %(time)s %(message)s",setLevel:function(level){this._level=level;return this},setFormat:function(format){this._format=format;return this},debug:function(message){this.DEBUG>=this._level&&this._out("DEBUG",message);return this},info:function(message){this.INFO>=this._level&&this._out("INFO",message);return this},warning:function(message){this.WARNING>=this._level&&this._out("WARNING",message);return this},error:function(message){this.ERROR>=this._level&&this._out("ERROR",message);return this},critical:function(message){this.CRITICAL>=this._level&&this._out("CRITICAL",message);return this},_out:function(level,message){var output=this._format;output=QQWB.format.sprintf(output,{name:QQWB._name,levelname:level,time:QQWB.time.shortTime(),message:message,frame:window!=window.parent?"*":""});QQWB._debug&&window.console&&window.console.log(output)}});QQWB.extend("cookie",{set:function(name,value,opt_maxage,opt_path,opt_domain){if(typeof opt_maxage==="undefined"||opt_maxage===null){opt_maxage=-1}var cookieDomain=opt_domain?"domain="+opt_domain:"";var cookiePath=opt_path?"path="+opt_path:"";var cookieExpire="";if(opt_maxage===0){cookieExpire="expires="+new Date(1970,1,1).toUTCString()}else if(opt_maxage>0){cookieExpire="expires="+new Date(+new Date+opt_maxage*1000).toUTCString()}document.cookie=[name+"="+value,cookieExpire,cookiePath,cookieDomain].join("; ");return this},get:function(name){var cookieName=name+"=";cookies=(document.cookie||"").split(/\s*;\s*/);for(var i=0,l=cookies.length;i<l;i++){var cookie=cookies[i];if(cookie.indexOf(cookieName)===0){return cookie.substr(cookieName.length)}}},del:function(name,opt_path,opt_domain){this.set(name,'',0,opt_path,opt_domain);if(document.cookie.indexOf(name+"=")>=0){QQWB.log.warning("Cookie may not be deleted as you expected")}return this}});QQWB.extend("_static",{GET:"GET",POST:"POST",GET_OR_POST:"GET | POST",CATEGORY_TIMELINE:"时间线",EMPTY_STR:"",NO_DEFAULT_VALUE:null,NO_DESCRIPTION:"暂时没有关于此参数的说明"});QQWB.extend("_apiProvider",{apiError:{httpHeaderFlag:/X-APIErrorCode:\s+(\d+)/,"1":"参数错误","2":"频率受限","3":"鉴权失败","4":"内部错误"},apis:{"/statuses/home_timeline":{category:"时间线",description:"主页时间线",supportMethod:"get",supportParams:{pageflag:{defalutValue:20,description:QQWB._static.NO_DESCRIPTION},reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},pagetime:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/statuses/public_timeline":{category:"时间线",description:"广播大厅时间线",supportMethod:"get",supportParams:{pos:{defalutValue:20,description:QQWB._static.NO_DESCRIPTION},reqnum:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/statuses/user_timeline":{category:"时间线",description:"其他用户发表时间线",supportMethod:"get",supportParams:{pageflag:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},pagetime:{defalutValue:20,description:QQWB._static.NO_DESCRIPTION},reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},lastid:{defalutValue:"t",description:QQWB._static.NO_DESCRIPTION},name:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/statuses/mentions_timeline":{category:"时间线",description:"@提到我的时间线",supportMethod:"get",supportParams:{pageflag:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},pagetime:{defalutValue:20,description:QQWB._static.NO_DESCRIPTION},reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},lastid:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/statuses/ht_timeline":{category:"时间线",description:"话题时间线",supportMethod:"post",supportParams:{httext:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},pageflag:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},pageinfo:{defalutValue:20,description:QQWB._static.NO_DESCRIPTION},reqnum:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/statuses/broadcast_timeline":{category:"时间线",description:"我发表时间线",supportMethod:"get",supportParams:{pageflag:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},pagetime:{defalutValue:20,description:QQWB._static.NO_DESCRIPTION},reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},lastid:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/statuses/special_timeline":{category:"时间线",description:"特别收听的人发表时间线",supportMethod:"get",supportParams:{pageflag:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},pagetime:{defalutValue:20,description:QQWB._static.NO_DESCRIPTION},reqnum:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/statuses/broadcast_timeline_ids":{category:"时间线",description:"我发表时间线索引",supportMethod:"get",supportParams:{pageflag:{defalutValue:20,description:QQWB._static.NO_DESCRIPTION},pagetime:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},reqnum:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},lastid:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},type:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},contenttype:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},accesslevel:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/statuses/home_timeline_ids":{category:"时间线",description:"首页时间线索引",supportMethod:"get",supportParams:{pageflag:{defalutValue:20,description:QQWB._static.NO_DESCRIPTION},pagetime:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},reqnum:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},lastid:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},type:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},contenttype:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},accesslevel:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/statuses/mentions_timeline_ids":{category:"时间线",description:"提及我的时间线索引",supportMethod:"get",supportParams:{pageflag:{defalutValue:20,description:QQWB._static.NO_DESCRIPTION},pagetime:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},reqnum:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},lastid:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},type:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},contenttype:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},accesslevel:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/statuses/user_timeline_ids":{category:"时间线",description:"用户发表时间线索引",supportMethod:"get",supportParams:{pageflag:{defalutValue:20,description:QQWB._static.NO_DESCRIPTION},pagetime:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},reqnum:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},lastid:{defalutValue:"t",description:QQWB._static.NO_DESCRIPTION},name:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},type:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},contenttype:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},accesslevel:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/statuses/users_timeline":{category:"时间线",description:"多用户发表时间线",supportMethod:"get",supportParams:{pageflag:{defalutValue:20,description:QQWB._static.NO_DESCRIPTION},pagetime:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},reqnum:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},lastid:{defalutValue:"t,api_weibo",description:QQWB._static.NO_DESCRIPTION},names:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},type:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},contenttype:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},accesslevel:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/statuses/users_timeline_ids":{category:"时间线",description:"多用户发表时间线索引",supportMethod:"get",supportParams:{pageflag:{defalutValue:20,description:QQWB._static.NO_DESCRIPTION},pagetime:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},reqnum:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},lastid:{defalutValue:"t,api_weibo",description:QQWB._static.NO_DESCRIPTION},names:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},type:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},contenttype:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},accesslevel:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/statuses/area_timeline":{category:"时间线",description:"同城发表时间线",supportMethod:"get",supportParams:{pos:{defalutValue:20,description:QQWB._static.NO_DESCRIPTION},reqnum:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},country:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},province:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},city:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/t/show":{category:"微博相关",description:"获取一条微博数据",supportMethod:"get",supportParams:{id:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/t/add":{category:"微博相关",description:"发表一条微博",supportMethod:"post",supportParams:{content:{defalutValue:"127.0.0.1",description:QQWB._static.NO_DESCRIPTION},clientip:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},jing:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},wei:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/t/del":{category:"微博相关",description:"删除一条微博",supportMethod:"post",supportParams:{id:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/t/re_add":{category:"微博相关",description:"转播一条微博",supportMethod:"post",supportParams:{content:{defalutValue:"127.0.0.1",description:QQWB._static.NO_DESCRIPTION},clientip:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},jing:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},wei:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},reid:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/t/reply":{category:"微博相关",description:"回复一条微博",supportMethod:"post",supportParams:{content:{defalutValue:"127.0.0.1",description:QQWB._static.NO_DESCRIPTION},clientip:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},jing:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},wei:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},reid:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/t/add_pic":{category:"微博相关",description:"发表一条图片微博",supportMethod:"post",supportParams:{content:{defalutValue:"127.0.0.1",description:QQWB._static.NO_DESCRIPTION},clientip:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},jing:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},wei:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/t/re_count":{category:"微博相关",description:"转播数或点评数",supportMethod:"post",supportParams:{ids:{defalutValue:2,description:QQWB._static.NO_DESCRIPTION},flag:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/t/re_list":{category:"微博相关",description:"获取单条微博的转发和点评列表",supportMethod:"get",supportParams:{flag:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},rootid:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},pageflag:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},pagetime:{defalutValue:20,description:QQWB._static.NO_DESCRIPTION},reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},twitterid:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/t/comment":{category:"微博相关",description:"点评一条微博",supportMethod:"post",supportParams:{content:{defalutValue:"127.0.0.1",description:QQWB._static.NO_DESCRIPTION},clientip:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},jing:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},wei:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},reid:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/t/add_music":{category:"微博相关",description:"发表音频微博",supportMethod:"post",supportParams:{content:{defalutValue:"127.0.0.1",description:QQWB._static.NO_DESCRIPTION},clientip:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},jing:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},wei:{defalutValue:"http://a.com/b.mp3",description:QQWB._static.NO_DESCRIPTION},url:{defalutValue:"歌名",description:QQWB._static.NO_DESCRIPTION},title:{defalutValue:"演唱者",description:QQWB._static.NO_DESCRIPTION},author:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/t/add_video":{category:"微博相关",description:"发表视频微博",supportMethod:"post",supportParams:{content:{defalutValue:"127.0.0.1",description:QQWB._static.NO_DESCRIPTION},clientip:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},jing:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},wei:{defalutValue:"http://v.youku.com/v_show/id_XMjExODczODM2.html",description:QQWB._static.NO_DESCRIPTION},url:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/t/getvideoinfo":{category:"微博相关",description:"获取视频信息",supportMethod:"post",supportParams:{url:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/t/list":{category:"微博相关",description:"根据微博ID批量得到微博数据",supportMethod:"get",supportParams:{ids:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/user/info":{category:"账户相关",description:"获取自己的详细资料",supportMethod:"get"},"/user/update":{category:"账户相关",description:"更新个人资料",supportMethod:"post",supportParams:{nick:{defalutValue:1,description:QQWB._static.NO_DESCRIPTION},sex:{defalutValue:2000,description:QQWB._static.NO_DESCRIPTION},year:{defalutValue:1,description:QQWB._static.NO_DESCRIPTION},month:{defalutValue:1,description:QQWB._static.NO_DESCRIPTION},day:{defalutValue:86,description:QQWB._static.NO_DESCRIPTION},countrycode:{defalutValue:34,description:QQWB._static.NO_DESCRIPTION},provincecode:{defalutValue:"0755",description:QQWB._static.NO_DESCRIPTION},citycode:{defalutValue:"i am ok.",description:QQWB._static.NO_DESCRIPTION},introduction:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/user/update_head":{category:"账户相关",description:"更新个人资料头像",supportMethod:"post",supportParams:{pic:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/user/other_info":{category:"账户相关",description:"获取其他人资料",supportMethod:"get",supportParams:{name:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/user/infos":{category:"账户相关",description:"多用户信息",supportMethod:"post",supportParams:{names:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/user/verify":{category:"账户相关",description:"验证账户是否合法（是否注册微博）",supportMethod:"post",supportParams:{name:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/friends/fanslist":{category:"关系链相关",description:"我的听众列表",supportMethod:"get",supportParams:{reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},startindex:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/friends/idollist":{category:"关系链相关",description:"我收听的人列表",supportMethod:"get",supportParams:{reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},startindex:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/friends/blacklist":{category:"关系链相关",description:"黑名单列表",supportMethod:"get",supportParams:{reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},startindex:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/friends/speciallist":{category:"关系链相关",description:"特别收听列表",supportMethod:"get",supportParams:{reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},startindex:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/friends/add":{category:"关系链相关",description:"收听某个用户",supportMethod:"post",supportParams:{name:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/friends/del":{category:"关系链相关",description:"取消收听某个用户",supportMethod:"post",supportParams:{name:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/friends/addspecial":{category:"关系链相关",description:"特别收听某个用户",supportMethod:"post",supportParams:{name:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/friends/delspecial":{category:"关系链相关",description:"取消特别收听某个用户",supportMethod:"post",supportParams:{name:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/friends/addblacklist":{category:"关系链相关",description:"添加某个用户到黑名单",supportMethod:"post",supportParams:{name:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/friends/delblacklist":{category:"关系链相关",description:"从黑名单中删除某个用户",supportMethod:"post",supportParams:{name:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/friends/check":{category:"关系链相关",description:"检查是否我的听众或收听的人",supportMethod:"get",supportParams:{names:{defalutValue:2,description:QQWB._static.NO_DESCRIPTION},flag:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/friends/user_fanslist":{category:"关系链相关",description:"其他账户听众列表",supportMethod:"get",supportParams:{reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},startindex:{defalutValue:"t",description:QQWB._static.NO_DESCRIPTION},name:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/friends/user_idollist":{category:"关系链相关",description:"其他账户收听的人列表",supportMethod:"get",supportParams:{reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},startindex:{defalutValue:"t",description:QQWB._static.NO_DESCRIPTION},name:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/friends/user_speciallist":{category:"关系链相关",description:"其他账户特别收听的人列表",supportMethod:"get",supportParams:{reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},startindex:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},name:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/friends/fanslist_s":{category:"关系链相关",description:"多听众列表",supportMethod:"get",supportParams:{reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},startindex:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/friends/idollist_s":{category:"关系链相关",description:"多收听人列表",supportMethod:"get",supportParams:{reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},startindex:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/private/add":{category:"私信相关",description:"发私信",supportMethod:"post",supportParams:{content:{defalutValue:"127.0.0.1",description:QQWB._static.NO_DESCRIPTION},clientip:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},jing:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},wei:{defalutValue:"t",description:QQWB._static.NO_DESCRIPTION},name:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/private/del":{category:"私信相关",description:"删除一条私信",supportMethod:"post",supportParams:{id:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/private/recv":{category:"私信相关",description:"收件箱",supportMethod:"get",supportParams:{pageflag:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},pagetime:{defalutValue:20,description:QQWB._static.NO_DESCRIPTION},reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},lastid:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/private/send":{category:"私信相关",description:"发件箱",supportMethod:"get",supportParams:{pageflag:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},pagetime:{defalutValue:20,description:QQWB._static.NO_DESCRIPTION},reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},lastid:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/search/user":{category:"搜索相关",description:"搜索用户",supportMethod:"get",supportParams:{keyword:{defalutValue:10,description:QQWB._static.NO_DESCRIPTION},pagesize:{defalutValue:1,description:QQWB._static.NO_DESCRIPTION},page:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/search/t":{category:"搜索相关",description:"搜索微博",supportMethod:"get",supportParams:{keyword:{defalutValue:10,description:QQWB._static.NO_DESCRIPTION},pagesize:{defalutValue:1,description:QQWB._static.NO_DESCRIPTION},page:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/search/userbytag":{category:"搜索相关",description:"通过标签搜索用户",supportMethod:"get",supportParams:{keyword:{defalutValue:10,description:QQWB._static.NO_DESCRIPTION},pagesize:{defalutValue:1,description:QQWB._static.NO_DESCRIPTION},page:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/trends/ht":{category:"热度趋势",description:"话题热榜",supportMethod:"get",supportParams:{type:{defalutValue:20,description:QQWB._static.NO_DESCRIPTION},reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},pos:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/trends/t":{category:"热度趋势",description:"热门转播",supportMethod:"get",supportParams:{reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},pos:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/info/update":{category:"查看数据",description:"更新条数",supportMethod:"get",supportParams:{op:{defalutValue:9,description:QQWB._static.NO_DESCRIPTION},type:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/fav/addt":{category:"数据收藏",description:"收藏一条微博",supportMethod:"post",supportParams:{id:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/fav/delt":{category:"数据收藏",description:"取消收藏一条微博",supportMethod:"post",supportParams:{id:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/fav/list_t":{category:"数据收藏",description:"收藏的微博列表",supportMethod:"get",supportParams:{pageflag:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},nexttime:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},prevtime:{defalutValue:20,description:QQWB._static.NO_DESCRIPTION},reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},lastid:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/fav/addht":{category:"数据收藏",description:"订阅话题",supportMethod:"post",supportParams:{id:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/fav/delht":{category:"数据收藏",description:"取消收藏话题",supportMethod:"post",supportParams:{id:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/fav/list_ht":{category:"数据收藏",description:"获取已订阅话题列表",supportMethod:"get",supportParams:{reqnum:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},pageflag:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},pagetime:{defalutValue:0,description:QQWB._static.NO_DESCRIPTION},lastid:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/ht/ids":{category:"话题相关",description:"根据话题名称查询话题ID",supportMethod:"get",supportParams:{httexts:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/ht/info":{category:"话题相关",description:"根据话题ID获取话题相关微博",supportMethod:"get",supportParams:{ids:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/tag/add":{category:"标签相关",description:"添加标签",supportMethod:"post",supportParams:{tag:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/tag/del":{category:"标签相关",description:"删除标签",supportMethod:"post",supportParams:{tagid:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/other/kownperson":{category:"其他",description:"我可能认识的人",supportMethod:"get",supportParams:{ip:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},country_code:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},province_code:{defalutValue:"",description:QQWB._static.NO_DESCRIPTION},city_code:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/other/kownperson":{category:"其他",description:"可能认识的人",supportMethod:"get"},"/other/shorturl":{category:"其他",description:"短URL转长URL",supportMethod:"get",supportParams:{url:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}},"/other/get_emtions":{category:"其他",description:"获取表情接口",supportMethod:"get",supportParams:{type:{defalutValue:QQWB._static.NO_DEFAULT_VALUE,description:QQWB._static.NO_DESCRIPTION}}}},getDescriptor:function(apiInterface){return this.apis[apiInterface]},isProvide:function(apiInterface){return!!this.getDescriptor(apiInterface)},describe:function(apiInterface){var descriptor=this.getDescriptor(apiInterface);if(descriptor){return descriptor.category+">"+descriptor.description}else{return""}}});QQWB.extend("XML",{isXML:function(xml){},toString:function(xml){var str;if(window.ActiveXObject){str=xml.xml}else{str=(new XMLSerializer()).serializeToString(xml)}return str},fromString:function(str){var xml;if(window.ActiveXObject){xml=new ActiveXObject("Microsoft.XMLDOM");xml.async="false";xml.loadXML(str)}else{var parser=new DOMParser();xml=parser.parseFromString(str,"text/xml")}return xml}},true);QQWB.extend("String",{_trimLeft:/^\s+/,_trimRight:/\s+$/,isString:function(source){return typeof source==="string"},ltrim:function(source){return source==null?"":source.toString().replace(this._trimLeft,"")},rtrim:function(source){return source==null?"":source.toString().replace(this._trimRight,"")},trim:String.prototype.trim?function(source){return source==null?"":String.prototype.trim.call(source)}:function(source){return source==null?"":source.toString().replace(this._trimLeft,"").replace(this._trimRight,"")},startsWith:String.prototype.startsWith?function(source,needle){return source==null?false:String.prototype.startsWith.call(source,needle)}:function(source,needle){return source==null?false:source.toString().indexOf(needle)==0},endsWith:String.prototype.endsWith?function(source,needle){return source==null?false:String.prototype.endsWith.call(source,needle)}:function(source,needle){return source==null?false:source.toString().lastIndexOf(needle)>=0&&source.toString().lastIndexOf(needle)+needle.length==source.length}});var JSON;if(!JSON){JSON={}}(function(){"use strict";function f(n){return n<10?'0'+n:n}if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+f(this.getUTCMonth()+1)+'-'+f(this.getUTCDate())+'T'+f(this.getUTCHours())+':'+f(this.getUTCMinutes())+':'+f(this.getUTCSeconds())+'Z':null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key)}if(typeof rep==='function'){value=rep.call(holder,key,value)}switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null'}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null'}v=partial.length===0?'[]':gap?'[\n'+gap+partial.join(',\n'+gap)+'\n'+mind+']':'['+partial.join(',')+']';gap=mind;return v}if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==='string'){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v)}}}}v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+mind+'}':'{'+partial.join(',')+'}';gap=mind;return v}}if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' '}}else if(typeof space==='string'){indent=space}rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify')}return str('',{'':value})}}if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j}throw new SyntaxError('JSON.parse')}}}());QQWB.extend("JSON",{fromString:function(source){if(!source||!QQWB.String.isString(source)){return{}}else{source=source.replace(/^\s+/,"").replace(/\s+$/,"");if(window.JSON&&window.JSON.parse){source=window.JSON.parse(source)}else{if(/^[\],:{}\s]*$/.test(source.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){source=(new Function("return "+data))()}else{throw new SyntaxError("Invalid JSON: "+source)}}return source}},toString:function(source){return source==null?"":window.JSON.stringify(source)},stringify:function(source){return QQWB.JSON.toString(source)},parse:function(source){return source==null?{}:window.JSON.parse(source)}},true);QQWB.extend("queryString",{encode:function(params,opt_sep,opt_encode){var regexp=/%20/g,sep=opt_sep||'&',encode=opt_encode||encodeURIComponent,pairs=[];for(var key in params){if(params.hasOwnProperty(key)){var val=params[key];if(val!==null&&typeof val!='undefined'){pairs.push(encode(key).replace(regexp,"+")+"="+encode(val).replace(regexp,"+"))}}}pairs.sort();return pairs.join(sep)},decode:function(str,opt_sep,opt_decode){var decode=opt_decode||decodeURIComponent,sep=opt_sep||'&',parts=str.split(sep),params={},pair;for(var i=0,l=parts.length;i<l;i++){pair=parts[i].split('=',2);if(pair&&pair[0]){params[decode(pair[0])]=decode(pair[1])}}return params}});QQWB.extend("Function",{isFunction:function(arg){return typeof arg==="function"}});QQWB.extend("Array",{isArray:function(arg){return Object.prototype.toString.call(arg)==="[object Array]"},inArray:function(arr,arg){for(var i=0,l=arr.length;i<l;i++){if(arg===arr[i]){return true}}return false},fromString:function(source,optSep,optMax){if(!QQWB.String.isString(source)){return[]}optSep=optSep||"";return optMax?source.split(optSep,optMax):source.split(optSep)},fromArguments:function(source,optMax){if(typeof source!=="object"){return[]}return optMax?Array.prototype.slice.call(source,optMax):Array.prototype.slice.call(source)},toArray:function(arg){if(typeof arg=="string"){return arg.split("")}else if(typeof arg=="object"){return Array.prototype.slice.call(arg,0)}else{return this.toArray(arg.toString())}},each:function(arr,handler){for(var i=0,l=arr.length;i<l;i++){if(false===handler(i,arr[i])){break}}}});QQWB.extend("deferred",{_promiseMethods:"done fail isResolved isRejected promise then always success error complete whatever".split(" "),_deferred:function(){var callbacks=[],fired,firing,cancelled,deferred={done:function(){if(!cancelled){var args=arguments,elem,_fired;if(fired){_fired=fired;fired=0}for(var i=0,l=args.length;i<l;i++){elem=args[i];if(QQWB.Array.isArray(elem)){deferred.done.apply(deferred,elem)}else if(QQWB.Function.isFunction(elem)){callbacks.push(elem)}}if(_fired){deferred.resolveWith(_fired[0],_fired[1])}}return this},resolveWith:function(context,args){if(!cancelled&&!fired&&!firing){args=args||[];firing=1;try{while(callbacks[0]){callbacks.shift().apply(context,args);}}finally{fired=[context,args];firing=0}}return this},resolve:function(){deferred.resolveWith(this,arguments);return this},isResolved:function(){return!!(firing||fired)},cancel:function(){cancelled=1;callbacks=[];return this}};return deferred},deferred:function(func){var promise,deferred=QQWB.deferred._deferred(),failDeferred=QQWB.deferred._deferred();QQWB.extend(deferred,{fail:failDeferred.done,then:function(doneCallbacks,failCallbacks){deferred.done(doneCallbacks).fail(failCallbacks);return this},always:function(){return deferred.done.apply(deferred,arguments).fail.apply(this,arguments)},rejectWith:failDeferred.resolveWith,reject:failDeferred.resolve,isRejected:failDeferred.isResolved,promise:function(obj){if(obj==null){if(promise){return promise}promise=obj={}}var i=QQWB.deferred._promiseMethods.length;while(i--){obj[QQWB.deferred._promiseMethods[i]]=deferred[QQWB.deferred._promiseMethods[i]]}return obj}});deferred.success=deferred.done;deferred.error=deferred.fail;deferred.complete=deferred.whatever=deferred.always;deferred.done(failDeferred.cancel).fail(deferred.cancel);delete deferred.cancel;func&&func.call(deferred,deferred);return deferred},when:function(firstParam){var args=arguments,length=args.length,count=length,deferred=length<=1&&firstParam&&QQWB.Function.isFunction(firstParam.promise)?firstParam:QQWB.deferred.deferred();function resolveFunc(i){return function(value){args[i]=arguments.length>1?QQWB.Array.fromArguments(arguments):value;if(!(--count)){deferred.resolveWith(deferred,QQWB.Array.fromArguments(args))}}}if(length>1){for(var i=0;i<length;i++){if(args[i]&&QQWB.Function.isFunction(args[i].promise)){args[i].promise().then(resolveFunc(i),deferred.reject)}else{--count;}if(!count){deferred.resolveWith(deferred,args);}}}else if(deferred!==firstParam){deferred.resolveWith(deferred,length?[firstParam]:[])}return deferred.promise()}});QQWB._alias(["task","when"],QQWB.deferred.when);QQWB.extend("io",{_IOScript:function(cfg){var script,head=document.head||document.getElementsByTagName("head")[0]||document.documentElement;return{send:function(complete){script=document.createElement("script");script.async="async";if(cfg.charset){script.charset=cfg.charset}script.src=cfg.url;script.onload=script.onreadystatechange=function(e,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;if(head&&script.parentNode){head.removeChild(script)}script=null;!isAbort&&complete&&complete.apply(QQWB,[200,"success"]);isAbort&&complete&&complete.apply(QQWB,[-1,"aborted"])}};script.onerror=function(e){complete&&complete.apply(QQWB,[404,e])};head.insertBefore(script,head.firstChild)},abort:function(){if(script){script.onload(0,1)}}}},_IOAjax:function(cfg){var callback,cfg=cfg||{},xhr=window.XMLHttpRequest?new window.XMLHttpRequest():new window.ActiveXObject("Microsoft.XMLHTTP");if(!cfg.async){cfg.async="async"}return{send:function(complete){if(cfg.username){xhr.open(cfg.type,cfg.url,cfg.async,cfg.username,cfg.password)}else{xhr.open(cfg.type,cfg.url,cfg.async)}try{if(cfg.type=="POST"){xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}xhr.setRequestHeader("X-Requested-With","XMLHttpRequest")}catch(ex){}xhr.send(cfg.data||null);callback=function(_,isAbort){var status,statusText,responseHeaders,responses,response,xml;try{if(callback&&(isAbort||xhr.readyState===4)){callback=null;if(isAbort){if(xhr.readyState!==4){xhr.abort()}}else{status=xhr.status;responseHeaders=xhr.getAllResponseHeaders();responses={};xml=xhr.responseXML;if(xml&&xml.documentElement){responses.xml=xml}responses.text=xhr.responseText;try{statusText=xhr.statusText}catch(webkitException){statusText=""}if(status===1223){status=204}if(cfg.dataType.toLowerCase()=="json"){response=QQWB.JSON.fromString(responses.text)}else if(cfg.dataType.toLowerCase()=="xml"){response=responses.xml}else{response=responses.text}}}}catch(firefoxException){if(!isAbort){complete(-1,firefoxException)}}if(response){complete(status,statusText,response,responseHeaders,cfg.dataType);}};if(!cfg.async||xhr.readyState===4){callback()}else{xhr.onreadystatechange=callback}},abort:function(){if(callback){callback(0,1)}}}},_IOFlash:function(cfg){var callback,readyState,cfg=cfg||{};return{send:function(complete){readyState=1;callback=function(_,isAbort){var status,statusText,responseHeaders,responses,response,xml,readyState=4;try{if(callback&&(isAbort||readyState==4)){callback=null;if(isAbort){complete(-1,"request has aborted")}else{var success=/complete/i.test(_.type);status=success?200:204;statusText=success?"ok":_.type;responseHeaders="";responses={};responses.text=_.target.data;if(cfg.dataType.toLowerCase()=="json"){response=QQWB.JSON.fromString(responses.text)}else if(cfg.dataType.toLowerCase()=="xml"){response=QQWB.XML.fromString(responses.text)}else{response=responses.text}}if(response){complete(status,statusText,response,responseHeaders)}}}catch(ex){if(!isAbort){complete(-1,ex+"")}}};if(!window.onFlashRequestComplete_8df046){window.onFlashRequestComplete_8df046=function(event){onFlashRequestComplete_8df046.callbacks.shift()(event)};window.onFlashRequestComplete_8df046.callbacks=[]}window.onFlashRequestComplete_8df046.callbacks.push(callback);if(QQWBFlashTransport&&QQWBFlashTransport.httpRequest){QQWBFlashTransport.httpRequest(cfg.url,cfg.data,cfg.type)}else{QQWB.log.critical("flash transportation object error"+QQWBFlashTransportName)}},abort:function(){if(callback){callback(0,1)}}}},_apiAjax:function(api,apiParams,dataType,type){var opts={type:type.toUpperCase(),url:QQWB._domain.api+api,data:QQWB.queryString.encode(apiParams),dataType:dataType};if(opts.type=="GET"){opts.url+=opts.data?"?"+opts.data:"";delete opts.data}return QQWB.io.ajax(opts)},_apiFlashAjax:function(api,apiParams,dataType,type){var opts={type:type.toUpperCase(),url:QQWB._domain.api+api,data:QQWB.queryString.encode(apiParams),dataType:dataType};if(opts.type=="GET"){opts.url+=opts.data?"?"+opts.data:"";delete opts.data}return QQWB.io.flashAjax(opts)},flashAjax:function(opts){var deferred=QQWB.deferred.deferred(),default_opts={type:"get",dataType:"json"};QQWB.extend(default_opts,opts,true);QQWB.io._IOFlash(default_opts).send(function(status,statusText,responses,responseHeaders){if(status!==200){deferred.reject(status,statusText)}else{if(responseHeaders&&QQWB._apiProvider.apiError.httpHeaderFlag.test(responseHeaders)){var apiErrorCode=responseHeaders.match(QQWB._apiProvider.apiError.httpHeaderFlag)[1];deferred.reject(parseInt(apiErrorCode,10),QQWB._apiProvider.apiError[apiErrorCode])}else{deferred.resolve(status,statusText,responses,responseHeaders)}}});return deferred.promise()},ajax:function(opts){var deferred=QQWB.deferred.deferred(),default_opts={type:"get",dataType:"json"};QQWB.extend(default_opts,opts,true);QQWB.io._IOAjax(default_opts).send(function(status,statusText,responses,responseHeaders,dataType){if(status!==200){deferred.reject(status,statusText)}else{if(responseHeaders&&QQWB._apiProvider.apiError.httpHeaderFlag.test(responseHeaders)){var apiErrorCode=responseHeaders.match(QQWB._apiProvider.apiError.httpHeaderFlag)[1];deferred.reject(parseInt(apiErrorCode,10),QQWB._apiProvider.apiError[apiErrorCode])}else{deferred.resolve(status,statusText,responses,responseHeaders,dataType)}}});return deferred.promise()},ajax2:function(opts){var deferred=QQWB.deferred.deferred(),default_opts={type:"get",dataType:"json"};QQWB.extend(default_opts,opts,true);QQWB.io._IOAjax(default_opts).send(function(status,statusText,responses,responseHeaders,dataType){if(status!==200){deferred.reject(status,statusText)}else{deferred.resolve(responses)}});return deferred.promise()},script:function(src,optCharset){var optCharset=optCharset||"utf-8",deferred=QQWB.deferred.deferred();QQWB.io._IOScript({charset:optCharset,url:src}).send(function(status,statusText){if(status!==200){deferred.reject(status,statusText)}else{deferred.resolve(status,statusText)}});return deferred.promise()},jsonp:function(opts){var deferred=QQWB.deferred.deferred(),callbackQueryName="callback",callbackNamePrefix="jsonp_",callbackName=callbackNamePrefix+QQWB.uid(),_oldcallback=window.callbackName,default_opts={dataType:"text",charset:"utf-8",url:""};QQWB.extend(default_opts,opts,true);if(default_opts.data){default_opts.url+=("?"+default_opts.data+"&"+callbackQueryName+"="+callbackName)}window[callbackName]=function(data){var response=data;if(default_opts.dataType.toLowerCase()==="json"){response=QQWB.JSON.fromString(data)}else if(default_opts.dataType.toLowerCase()==="xml"){response=QQWB.XML.fromString(data)}deferred.resolve(response);window[callbackName]=_oldcallback;};QQWB.io._IOScript(default_opts).send(function(status,statusText){if(status!==200){deferred.reject(status,statusText)}});return deferred.promise()}});QQWB._alias("ajax",QQWB.io.ajax2);QQWB._alias("jsonp",QQWB.io.jsonp);QQWB._alias("script",QQWB.io.script);QQWB.extend("_token",{setAccessToken:function(accessToken,expireIn,optUsername,optNickname){var tokenUser=this.getTokenUser(true);QQWB.cookie.set(QQWB._cookie.names.accessToken,[accessToken,QQWB.time.now()+expireIn*1000,optUsername||(tokenUser&&tokenUser.name)||"",optNickname||(tokenUser&&tokenUser.nick)||""].join("|"),365*24*3600,QQWB._cookie.path,QQWB._cookie.domain);return QQWB},getAccessToken:function(optRaw){var token=QQWB.cookie.get(QQWB._cookie.names.accessToken);if(token){token=token.split("|",2);if(optRaw||parseInt(token[1],10)>QQWB.time.now()){return token[0]}}},getTokenUser:function(optRaw){var token=QQWB.cookie.get(QQWB._cookie.names.accessToken);if(token){token=token.split("|",4);if(optRaw||parseInt(token[1],10)>QQWB.time.now()){return{name:token[2],nick:token[3]}}}},clearAccessToken:function(){QQWB.cookie.del(QQWB._cookie.names.accessToken,QQWB._cookie.path,QQWB._cookie.domain);return QQWB},setRefreshToken:function(refreshToken){QQWB.cookie.set(QQWB._cookie.names.refreshToken,refreshToken,365*24*3600,QQWB._cookie.path,QQWB._cookie.domain);return QQWB},getRefreshToken:function(){return QQWB.cookie.get(QQWB._cookie.names.refreshToken)},clearRefreshToken:function(){QQWB.cookie.del(QQWB._cookie.names.refreshToken,QQWB._cookie.path,QQWB._cookie.domain);return QQWB},exchangeForToken:function(optSuccessCallback){QQWB.io.jsonp({url:QQWB._domain.exchange,data:QQWB.queryString.encode({response_type:"token",client_id:QQWB._appkey,scope:"all",state:"1",refresh_token:this.getRefreshToken(),access_token:this.getAccessToken(true)})}).success(function(response){var _response=response;response=QQWB.queryString.decode(response);if(response.access_token){!response.expires_in&&QQWB.log.error("token expires_in not retrieved");!response.wbname&&QQWB.log.warning("weibo username not retrieved, will not update username");!response.wbnick&&QQWB.log.warning("weibo usernick not retrieved, will not update usernick");QQWB._token.setAccessToken(response.access_token,parseInt(response.expires_in,10),response.wbname,response.wbnick);if(response.refresh_token){QQWB._token.setRefreshToken(response.refresh_token)}else{QQWB.log.error("refresh token not retrieved")}QQWB.log.info("exchange token succeed")}else if(response.error){QQWB.log.error("exchange token error "+response.error)}else{QQWB.log.error("unexpected result returned from server "+_response+" while exchanging for new access token")}optSuccessCallback&&optSuccessCallback.call(QQWB,response)}).error(function(status,statusText){if(status===404){QQWB.log.error("exchange token has failed, script not found")}else{QQWB.log.error("exchange token has failed, "+statusText)}});return QQWB},getNewAccessToken:function(optSuccessCallback){QQWB.io.jsonp({url:QQWB._domain.query,data:QQWB.queryString.encode({response_type:"token",client_id:QQWB._appkey,scope:"all",state:"1"})}).success(function(response){var _response=response;response=QQWB.queryString.decode(response);if(response.access_token){!response.expires_in&&QQWB.log.error("token expires_in not retrieved");!response.wbname&&QQWB.log.warning("weibo username not retrieved");!response.wbnick&&QQWB.log.warning("weibo usernick not retrieved");QQWB._token.setAccessToken(response.access_token,parseInt(response.expires_in,10),response.wbname,response.wbnick);if(response.refresh_token){QQWB._token.setRefreshToken(response.refresh_token)}else{QQWB.log.error("refresh token not retrieved")}QQWB.log.info("retrieve new access token succeed")}else if(response.error){QQWB.log.error("retrieve new access token error "+response.error)}else{QQWB.log.error("unexpected result returned from server "+_response+" while retrieving new access token")}optSuccessCallback&&optSuccessCallback.call(QQWB,response)}).error(function(status,statusText){if(status===404){QQWB.log.error("get token has failed, script not found")}else{QQWB.log.error("get token failed, "+statusText)}});return QQWB},resolveResponse:function(responseText,optGlobal){var loginStatus,global=(optGlobal||window)["QQWB"],response=global.queryString.decode(responseText);if(response.access_token){global._token.setAccessToken(response.access_token,parseInt(response.expires_in,10),response.wbname,response.wbnick);if(response.refresh_token){global._token.setRefreshToken(response.refresh_token)}else{global.log.error("refresh token not retrieved")}loginStatus=global.loginStatus();global.log.info("user "+loginStatus.name+" logged in");global.trigger(global.events.USER_LOGGEDIN_EVENT,loginStatus)}else if(response.error){global.log.error("login error occurred "+response.error);response.message=response.error;global.trigger(global.events.USER_LOGIN_FAILED_EVENT,response)}else{global.log.error("unexpected result returned from server "+_response);global.trigger(global.events.USER_LOGIN_FAILED_EVENT,response)}}});QQWB.extend("_eventProvider",{_getEventsMap:function(){if(!this._eventsMap){this._eventsMap={}}return this._eventsMap},bind:function(name,handler){var evts=this._getEventsMap();if(!evts[name]){evts[name]=[handler]}else{if(!QQWB.Array.inArray(evts[name],handler)){evts[name].push(handler)}}},unbind:function(name,handler){var handlers=this._getEventsMap()[name];if(handlers){if(handler){for(var i=0,l=handlers.length;i<l;i++){if(handler===handlers[i]){handlers[i]=null}}}else{delete this._getEventsMap()[name]}}},trigger:function(name,data){var handlers=this._getEventsMap()[name];if(handlers){for(var i=0,l=handlers.length;i<l;i++){var handler=handlers[i];if(handler){handler.call(QQWB,data)}}}}});QQWB.extend("",{bind:function(name,handler){name=name.toLowerCase();this._eventProvider.bind(name,handler);return this},unbind:function(name,handler){name=name.toLowerCase();this._eventProvider.unbind(name,handler);return this},trigger:function(name,data){name=name.toLowerCase();this._eventProvider.trigger(name,data);return this}});QQWB.extend("events",{USER_LOGGEDIN_EVENT:"UserLoggedIn",USER_LOGIN_FAILED_EVENT:"UserLoginFailed",USER_LOGGEDOUT_EVENT:"UserLoggedOut",TOKEN_READY_EVENT:"tokenReady",DOCUMENT_READY_EVENT:"documentReady",EVERYTHING_READY_EVENT:"everythingReady"});QQWB.extend("",{login:function(optSuccessHandler,optFailHandler){if(!this._inited){this.log.critical("Library not initialized, call T.init() to initialize")}var loginStatus=this.loginStatus();optSuccessHandler&&this.bind(this.events.USER_LOGGEDIN_EVENT,optSuccessHandler);optFailHandler&&this.bind(this.events.USER_LOGIN_FAILED_EVENT,optFailHandler);if(loginStatus){optSuccessHandler&&optSuccessHandler.call(this,loginStatus);this.trigger(this.events.USER_LOGGEDIN_EVENT,loginStatus)}else{var currWindow={x:window.screenX||window.screenLeft,y:window.screenY||window.screenTop,width:window.outerWidth||document.documentElement.clientWidth,height:window.outerHeight||document.documentElement.clientHeight},authWindow={width:500,height:300,authQuery:function(){return QQWB.queryString.encode({response_type:"token",client_id:QQWB._appkey,redirect_uri:QQWB._domain.clientproxy,referer:document.location.href,scope:"all"})},x:function(){return parseInt(currWindow.x+(currWindow.width-this.width)/2,10)},y:function(){return parseInt(currWindow.y+(currWindow.height-this.height)/2,10)},popup:function(){this.contentWindow=window.open(QQWB._domain.auth+"?"+this.authQuery(),"",["height=",this.height,", width=",this.width,", top=",this.y(),", left=",this.x(),", toobar=","no",", menubar=","no",", scrollbars=","no",", resizable=","yes",", location=","yes",", status=","no"].join(""));return this},focus:function(){this.contentWindow&&this.contentWindow.focus&&this.contentWindow.focus();return this}};authWindow.popup().focus();if(this.browser.msie){(function(){var responseText;if(authWindow.contentWindow.closed){responseText="error=access_denied";QQWB._token.resolveResponse(responseText);return}try{responseText=authWindow.contentWindow.location.hash.split("#").pop();QQWB._token.resolveResponse(responseText);authWindow.contentWindow.close()}catch(ex){setTimeout(arguments.callee,0)}}())}else{QQWB._startTrackingAuthWindowStatus();(function(){var responseText;if(!QQWB._isTrackingAuthWindowStatus()){return}if(authWindow.contentWindow.closed){responseText="error=access_denied";QQWB._token.resolveResponse(responseText);return}else{setTimeout(arguments.callee,0)}}())}}return this},logout:function(optHandler){if(!this.loginStatus()){this.log.info("user not logged in")}else{this._token.clearAccessToken();this._token.clearRefreshToken()}optHandler&&optHandler.call(this);this.trigger(this.events.USER_LOGGEDOUT_EVENT);return this},loginStatus:function(optCallback){var status,accessToken=this._token.getAccessToken(),user=this._token.getTokenUser();if(accessToken){status={access_token:accessToken,name:user.name,nick:user.nick}}optCallback&&optCallback.call(this,status);return status},_isTrackingAuthWindowStatus:function(){return!!this._trackAuthWindowStatus},_startTrackingAuthWindowStatus:function(){this._trackAuthWindowStatus=true},_stopTrackingAuthWindowStatus:function(){this._trackAuthWindowStatus=false}});QQWB.provide("api",function(api,apiParams,optDataType,optType,optSolution){apiParams=apiParams||{};optDataType=(optDataType||"json").toLowerCase();optType=optType||"GET";var promise,solution,format=optDataType,supportedFormats={json:true,xml:true},deferred=QQWB.deferred.deferred();if(!(format in supportedFormats)){format="json"}apiParams["access_token"]=QQWB._token.getAccessToken();apiParams["version"]="2.0";apiParams["format"]=format;promise=deferred.promise();if(optSolution&&QQWB.Array.inArray([QQWB._solution.HTML5_SOLUTION,QQWB._solution.FLASH_SOLUTION,QQWB._solution.SILVER_LIGHT_SOLUTION],optSolution)){QQWB.log.warning("forced to use solution "+optSolution);if(!QQWB._solution[optSolution]){QQWB.log.warning("forced to use solution "+optSolution+", this solution is not inited, initialzing...");QQWB._solution.initSolution[optSolution]}solution=QQWB._solution[optSolution]}else{solution=(QQWB.browser.feature.postmessage&&QQWB._solution[QQWB._solution.HTML5_SOLUTION])||(QQWB.browser.feature.flash&&QQWB._solution[QQWB._solution.FLASH_SOLUTION])||(QQWB.browser.feature.silverlight&&QQWB._solution[QQWB._solution.SILVER_LIGHT_SOLUTION])}if(!solution||solution.readyState===2){QQWB.log.critical("solution error");deferred.reject(-1,"solution error");return promise}if(solution.readyState===0){QQWB.log.warning("solution is not ready, your api call request has been cached, will invoke immediately when solution is ready");solution.promise.done(function(){QQWB.log.info("invoking cached api call \"QQWB.api( "+[api,apiParams,optDataType,optType].join(",")+" )\"...");QQWB.api(api,apiParams,optDataType,optType).success(function(){deferred.resolveWith(deferred,QQWB.Array.fromArguments(arguments))}).error(function(){deferred.rejectWith(deferred,QQWB.Array.fromArguments(arguments))});}).fail(function(){QQWB.log.error("can't invoking cached api call \"QQWB.api( "+[api,apiParams,optDataType,optType].join(",")+" )\"");deferred.rejectWith(deferred,QQWB.Array.fromArguments(arguments))});return promise}if(!QQWB.loginStatus()){deferred.reject(-1,"not login");return promise}if(!QQWB.api.id){QQWB.extend(QQWB.api,{id:0,total:function(){return QQWB.api.id}})}QQWB.api.id++;QQWB.log.info("["+QQWB.api.id+"] requesting data \""+QQWB._apiProvider.describe(api)+"\" from server...");if(solution===QQWB._solution[QQWB._solution.HTML5_SOLUTION]){var serverProxy=document.getElementById(solution.id);if(!serverProxy){QQWB.log.critical("server proxy not found");deferred.reject(-1,"server proxy not found")}else{if(serverProxy.src!==QQWB._domain.serverproxy){QQWB.log.critical("server proxy is not valid, src attribute has unexpected value");deferred.reject(-1,"server proxy not valid")}else{if(!QQWB.api._deferredCollection){QQWB.extend(QQWB.api,{_deferredCollection:{},deferredAt:function(deferredId){if(this._deferredCollection[deferredId]){return this._deferredCollection[deferredId]}else{QQWB.log.warning("get deferred object has failed, that object does not exist at index "+deferredId)}},uncollect:function(deferredId){if(this._deferredCollection[deferredId]){delete this._deferredCollection[deferredId]}else{QQWB.log.warning("uncollect deferred object has failed, that object does not exist at index "+deferredId)}},collect:function(deferredObj){if(deferredObj.promise){this._deferredCollection[this.id]=deferredObj;return this.id}else{QQWB.log.warning("collect a non-deferred object is illegal")}}})}if(!QQWB.api.messageHandler){QQWB.provide("api.messageHandler",function(e){if(QQWB._domain.serverproxy.indexOf(e.origin)!==0){QQWB.log.warning("unexpected message arrived from "+e.origin+" with data "+e.data)}else{var data=QQWB.JSON.fromString(e.data),id=data.id,relateDeferred=QQWB.api.deferredAt(id),response=data.data;if(relateDeferred){if(response[0]!==200){relateDeferred.reject.apply(relateDeferred,response)}else{if(response[4]=="xmltext"){response[2]=QQWB.XML.fromString(response[2])}relateDeferred.resolve(response[2])}QQWB.api.uncollect(id)}else{QQWB.log.warning("related deferred object not found, it shouldn't happen")}}});if(window.addEventListener){window.addEventListener("message",QQWB.api.messageHandler,false)}else if(window.attachEvent){window.attachEvent("onmessage",QQWB.api.messageHandler)}}try{var collectionID=QQWB.api.collect(deferred);setTimeout(function(){serverProxy.contentWindow.postMessage(QQWB.JSON.stringify({id:collectionID,data:[api,apiParams,optDataType,optType]}),QQWB._domain.serverproxy)},0)}catch(ex){QQWB.log.critical("post message to server proxy has failed, "+ex);deferred.reject(-1,ex)}}}}else if(solution===QQWB._solution[QQWB._solution.FLASH_SOLUTION]){QQWB.io._apiFlashAjax(api,apiParams,optDataType,optType).complete(function(){var response=QQWB.Array.fromArguments(arguments);if(response[0]!==200){deferred.reject.apply(deferred,response)}else{deferred.resolve(response[2])}})}(function(){var serial=QQWB.api.id;promise.complete(function(){QQWB.log.info("*["+serial+"] done");serial=null;})}());return promise});QQWB.provide("man",function(api){return this._apiProvider.getDescriptor(api)?QQWB.JSON.toString(this._apiProvider.getDescriptor(api)):"no such api"});QQWB.extend("dom",{create:function(tagName,optAttrs){var element=document.createElement(tagName+"");if(optAttrs&&element){for(attr in optAttrs){if(optAttrs.hasOwnProperty(attr)){element[attr]=optAttrs[attr]}}}return element},createHidden:function(optTagName,optAttrs,optFake){optTagName=optTagName||"div";var el=this.create(optTagName,optAttrs);el.width=el.height=0;el.style.width=el.style.height=0;el.style.position="absolute";el.style.top="-9999px";if(optFake){~0}else{el.style.display="none"}return el},append:function(child,parent){parent=parent||document.body;if(child&&child.nodeType){parent.appendChild(child)}return this},html:function(node,html){node&&node.nodeType&&html&&(node.innerHTML=html);return this},appendHidden:function(html,optAttrs,optFake){var hidden=this.createHidden(null,optAttrs,optFake);this.html(hidden,html);return this.append(hidden)},remove:function(node){node&&node.nodeType&&node.parentNode&&node.parentNode.removeChild(node);return this}});QQWB.extend("door",{doors:0,door:function(optLockDo,optUnlockDo){var locks=0;this.doors++;return{lock:function(){locks++;optLockDo&&optLockDo.call(QQWB);return this},unlock:function(){locks--;locks=Math.max(0,locks);optUnlockDo&&optUnlockDo.call(QQWB);return this},isOpen:function(){return locks===0}}},count:function(){return this.doors}});(function(){var browserMatch;var ua=navigator.userAgent,rmsie=/(msie) ([\w.]+)/,ropera=/(opera)(?:.*version)?[ \/]([\w.]+)/,rwebkit=/(webkit)[ \/]([\w.]+)/,rmozilla=/(mozilla)(?:.*? rv:([\w.]+))?/;var browserFeatures={},browserPrefixes=["Webkit","Moz","O","ms","khtml"],featureTests={"cookie":function(){var cookieEnabled=navigator.cookieEnabled;if(cookieEnabled&&QQWB.browser.webkit){var cookiename="COOKIE_TEST_"+QQWB.uid();document.cookie=cookiename+"="+1+"; domain=; path=;";if(document.cookie.indexOf(cookiename)<0){cookieEnabled=false}else{document.cookie=cookiename+"="+"; expires="+new Date(1970,1,1).toUTCString()+"; domain=; path=;"}}!cookieEnabled&&QQWB.log.critical("Your browser doesn't support cookie or cookie isn't enabled");return cookieEnabled},"flash":function(){if(typeof navigator.plugins!="undefined"&&typeof navigator.plugins["Shockwave Flash"]=="object"){var desc=navigator.plugins["Shockwave Flash"].description;var enabled=typeof navigator.mimeTypes!="undefined"&&navigator.mimeTypes["application/x-shockwave-flash"]&&navigator.mimeTypes["application/x-shockwave-flash"].enabledPlugin;return desc&&enabled}else if(typeof window.ActiveXObject!="undefined"){try{var flashAX=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(flashAX){return flashAX.getVariable("$version")}}catch(ex){}}},"userdata":function(){return QQWB.browser.msie},"postmessage":function(){return!!window.postMessage&&((QQWB.browser.msie&&parseInt(QQWB.browser.version,10)<8)?false:true)},"canvas":function(){var elem=document.createElement("canvas");return!!(elem.getContext&&elem.getContext("2d"))},"webgl":function(){return!!window.WebGLRenderingContext},"geolocation":function(){return!!navigator.geolocation},"websqldatabase":function(){return!!window.openDatabase},"indexeddb":function(){for(var i=0,l=browserPrefixes.length;i<l;i++){if(window[browserPrefixes[i].toLowerCase()+"IndexedDB"]){return true}}return!!window.indexedDB},"websocket":function(){for(var i=0,l=browserPrefixes.length;i<l;i++){if(window[browserPrefixes[i].toLowerCase()+"WebSocket"]){return true}}return!!window.WebSocket},"localstorage":function(){return window.localStorage&&localStorage.getItem},"sessionstorage":function(){return window.sessionStorage&&sessionStorage.getItem},"webworker":function(){return!!window.Worker},"applicationcache":function(){return!!window.applicationCache}};function uaMatch(ua){ua=ua.toLowerCase();var match=rwebkit.exec(ua)||ropera.exec(ua)||rmsie.exec(ua)||ua.indexOf("compatible")<0&&rmozilla.exec(ua)||[];return{browser:match[1]||"unknown",version:match[2]||"0"}}function featureTest(){for(var feature in featureTests){if(featureTests.hasOwnProperty(feature)){if(featureTests[feature]()){browserFeatures[feature]=true}}}}browserMatch=uaMatch(ua);QQWB.extend('browser',{"version":browserMatch.version});QQWB.browser[browserMatch.browser]=true;featureTest();QQWB.extend('browser.feature',browserFeatures)}());QQWB.extend("flash",{load:function(swfPath,optCallback){if(!this.loadedSwfs){this.loadedSwfs=[]}if(QQWB.Array.inArray(this.loadedSwfs,swfPath)){QQWB.log.warning(swfPath+"is already loaded");return}swfPath+="?"+QQWB.uid();var movieContainerId="movieContainer_"+QQWB.uid(),movieName="movie_"+QQWB.uid(),flashReadyCallbackName="onFlashReady_a1f5b4ce",_flashReady=window[flashReadyCallbackName];window[flashReadyCallbackName]=function(){optCallback&&optCallback(movieName);window[flashReadyCallbackName]=_flashReady;_flashReady=null;optCallback&&(optCallback=null);movieName=null};QQWB.dom.appendHidden(['<object','type="application/x-shockwave-flash"','id="'+movieName+'"',QQWB.browser.msie?'name="'+movieName+'"':'',QQWB.browser.msie?'data="'+swfPath+'"':'',QQWB.browser.msie?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"':'','allowscriptaccess="always">','<param name="movie" value="'+swfPath+'"></param>','<param name="allowscriptaccess" value="always"></param>','</object>'].join(" "),{id:movieContainerId},true);return document.getElementById(movieContainerId)},getSWFObjectByName:function(name){if(QQWB.browser.msie){return window[name]}else{if(document[name].length){return document[name][1]}return document[name]}}});QQWB.extend("_solution",{HTML5_SOLUTION:"html5",FLASH_SOLUTION:"flash",SILVER_LIGHT_SOLUTION:"silverlight",initSolution:function(name){var solution,solutionInit=QQWB.deferred.deferred();if(!this[name]&&QQWB.Array.inArray([this.HTML5_SOLUTION,this.FLASH_SOLUTION,this.SILVER_LIGHT_SOLUTION],name)){this[name]={};this[name]["readyState"]=0;this[name]["id"]="solution_"+QQWB.uid();this[name]["deferred"]=QQWB.deferred.deferred();this[name]["promise"]=this[name]["deferred"].promise()}if(this[name]&&this[name].readyState!==0){this[name].deferred.success(function(){solutionInit.resolve(QQWB.Array.fromArguments(arguments))}).fail(function(){solutionInit.reject(QQWB.Array.fromArguments(arguments))})}else{switch(name){case this.HTML5_SOLUTION:if(QQWB.browser.feature.postmessage){solution=this[this.HTML5_SOLUTION];var messageHandler=function(e){if(QQWB._domain.serverproxy.indexOf(e.origin)!==0){QQWB.log.warning("unexpected message arrived from "+e.origin+" with data "+e.data)}else{if(e.data==="success"){QQWB.log.info("html5 solution was successfully initialized");solution.readyState=1;solution.deferred.resolve()}else{QQWB.log.info("unexpected solution signal "+e.data)}}if(window.addEventListener){window.removeEventListener("message",messageHandler,false)}else if(window.attachEvent){window.detachEvent("onmessage",messageHandler)}messageHandler=null};if(window.addEventListener){window.addEventListener("message",messageHandler,false)}else if(window.attachEvent){window.attachEvent("onmessage",messageHandler)}QQWB.everythingReady(function(){QQWB.log.info("init html5 solution...");serverframe=QQWB.dom.createHidden("iframe",{id:solution.id,src:QQWB._domain.serverproxy});QQWB.dom.append(serverframe);serverframe.onload=function(e){setTimeout(function(){if(solution.readyState!==1){QQWB.log.error("html5 solution initialition has failed, server proxy frame encountered error");solution.readyState=2;solution.deferred.reject(-1,"server proxy frame not working")}},1*1000)}})}else{QQWB.log.error("can't init solution \""+name)+"\",browser doesn't support postmessage";solutionInit.reject("browser not supported")}break;case this.FLASH_SOLUTION:if(QQWB.browser.feature.flash){solution=this[this.FLASH_SOLUTION];QQWB.everythingReady(function(){QQWB.log.info("init flash solution...");var resolveTimer,resolveTimeout=10*1000,movieBox=QQWB.flash.load(QQWB._domain.flashproxy,function(moviename){QQWB.log.info("flash solution initlized successfully");solution.readyState=1;window["QQWBFlashTransport"]=QQWB.flash.getSWFObjectByName(moviename);resolveTimer&&clearTimeout(resolveTimer);solution.deferred.resolve()});resolveTimer=setTimeout(function(){if(!solution.deferred.isResolved()){solution.readyState=2;solution.deferred.reject(-1,"encounter error while loading proxy swf, need newer flash player");QQWB.dom.remove(movieBox)}},resolveTimeout);})}else{QQWB.log.error("can't init solution \""+name)+"\",browser doesn't support flash or flash is disabled";solutionInit.reject("browser not supported")}break;case this.SILVER_LIGHT_SOLUTION:if(QQWB.browser.feature.silverlight){~1;QQWB.log.error("sorry, silverlight solution is not implemented")}else{QQWB.log.error("can't init solution \""+name)+"\",browser doesn't support silverlight or silverlight is disabled";solutionInit.reject("browser not supported")}break;default:QQWB.log.error("can't init solution \""+name)+"\",not supported";solutionInit.reject("solution "+name+" not supported");break}}return solutionInit.promise()}});QQWB.extend("",{init:function(opts){if(this._inited===true){this.log.warning("already initialized");return this}this.log.info("init signal has arrived");var accessToken=this._token.getAccessToken(),rawAccessToken=this._token.getAccessToken(true),refreshToken=this._token.getRefreshToken(),needExchangeToken=refreshToken&&!accessToken&&rawAccessToken,needRequestNewToken=false&&!refreshToken&&!accessToken,clientProxy=opts.proxy||document.location.href;if(opts.appkey){this.log.info("client id is "+opts.appkey);this.assign("_appkey","APPKEY",opts.appkey)}this.log.info("client proxy uri is "+clientProxy);this.assign("_domain","CLIENTPROXY_URI",clientProxy);if(needExchangeToken||needRequestNewToken){QQWB._tokenReadyDoor.lock();}if(needExchangeToken){this.log.info("exchanging refresh token to access token...");QQWB._token.exchangeForToken(function(response){if(response.error){QQWB.log.warning("exchange token has failed, trying to retrieve a new access_token...");this._tokenReadyDoor.lock();QQWB._token.getNewAccessToken(function(){this._tokenReadyDoor.unlock();})}this._tokenReadyDoor.unlock();})}else if(needRequestNewToken){this.log.info("retrieving new access token...");QQWB._token.getNewAccessToken(function(){QQWB._tokenReadyDoor.unlock();})}this._inited=true;QQWB._tokenReadyDoor.unlock();return this},_tokenReadyDoor:QQWB.door.door(function(){this.log.info("tokenReady is locked")},function(){this.log.info("tokenReady is unlocked");this._tokenReadyDoor.isOpen()&&this.log.info("token is ready")&&this.trigger(this.events.TOKEN_READY_EVENT)}),tokenReady:function(handler){if(this._tokenReadyDoor.isOpen()){handler&&handler()}else{this.bind(this.events.TOKEN_READY_EVENT,handler)}return this},_isDocumentReady:false,_tryToTriggerDocumentReadyEvents:function(){if(this._isDocumentReady){return}try{var el=document.getElementsByTagName("body")[0].appendChild(document.createElement("span"));el.parentNode.removeChild(el)}catch(ex){return}this._isDocumentReady=true;this.log.info("document is ready");this._everythingReadyDoor.unlock();this.trigger(this.events.DOCUMENT_READY_EVENT)},documentReady:function(handler){if(this._isDocumentReady){handler&&handler()}else{this.bind(this.events.DOCUMENT_READY_EVENT,handler);this._tryToTriggerDocumentReadyEvents();}},_everythingReadyDoor:QQWB.door.door(function(){this.log.info("everythingReady is locked")},function(){this.log.info("everythingReady is unlocked");this._everythingReadyDoor.isOpen()&&this.log.info("everything is ready")&&this.trigger(this.events.EVERYTHING_READY_EVENT)}),everythingReady:function(handler){if(this._everythingReadyDoor.isOpen()){handler&&handler()}else{this.bind(this.events.EVERYTHING_READY_EVENT,handler);}return this}});(function(){var self=window,openerProp=self.opener,parentProp=self.parent,inPopup=!!openerProp,inFrame=self!=parentProp,asServer=QQWB._domain.serverproxy===self.location.href;function initSolution(){if(QQWB.browser.feature.postmessage){QQWB._solution.initSolution(QQWB._solution.HTML5_SOLUTION)}else if(QQWB.browser.feature.flash){QQWB._solution.initSolution(QQWB._solution.FLASH_SOLUTION)}else{QQWB.log.error("init solution is called, but no solution for the browser")}}QQWB._tokenReadyDoor.lock();QQWB._everythingReadyDoor.lock();QQWB._everythingReadyDoor.lock();QQWB.bind(QQWB.events.TOKEN_READY_EVENT,function(){QQWB._everythingReadyDoor.unlock();});if(inPopup){QQWB.log.info("library booting at popup mode");openerProp.location.href?QQWB._token.resolveResponse(window.location.hash.split("#").pop(),openerProp):QQWB.log.critical("crossdomain login is not supported currently");openerProp.QQWB._stopTrackingAuthWindowStatus();window.close();return}if(inFrame&&asServer&&QQWB.browser.feature.postmessage){QQWB.log.info("library booting at server proxy mode");var targetOrigin="*",appWindow=parentProp;appWindow.postMessage("success",targetOrigin);var messageHandler=function(e){var data=QQWB.JSON.fromString(e.data),id=data.id,args=data.data,apiInterface=args[0];if(args[2].toLowerCase()=="xml"){args[2]="xmltext"}if(!apiInterface){appWindow.postMessage(QQWB.JSON.toString({id:id,data:[-1,"interface can not be empty"]}),targetOrigin);QQWB.log.error("interface is empty")}else{if(!QQWB._apiProvider.isProvide(apiInterface)){appWindow.postMessage(QQWB.JSON.toString({id:id,data:[-1,"interface \""+apiInterface+"\" is not supported"]}),targetOrigin);QQWB.log.error("interface \""+apiInterface+"\" is not allowed to be called")}else{QQWB.io._apiAjax.apply(this,args).complete(function(){appWindow.postMessage(QQWB.JSON.toString({id:id,data:QQWB.Array.fromArguments(arguments)}),targetOrigin)})}}};if(self.addEventListener){self.addEventListener("message",messageHandler,false)}else if(window.attachEvent){self.attachEvent("onmessage",messageHandler)}return}QQWB.log.info("library booting at normal mode");initSolution()}());if(!QQWB._isDocumentReady){if(window.addEventListener){document.addEventListener("DOMContentLoaded",function(){QQWB._tryToTriggerDocumentReadyEvents()},false)}if(window.attachEvent){document.attachEvent("onreadystatechange",function(){if(/complete/.test(document.readyState)){document.detachEvent("onreadystatechange",arguments.callee);QQWB._tryToTriggerDocumentReadyEvents()}});if(window===window.top){(function(){if(QQWB._isDocumentReady){return}try{document.documentElement.doScroll("left")}catch(ex){setTimeout(arguments.callee,0);return;}QQWB._tryToTriggerDocumentReadyEvents()}())}}if(QQWB.browser.webkit){(function(){if(QQWB._isDocumentReady){return}if(!(/load|complete/.test(document.readyState))){setTimeout(arguments.callee,0);return;}QQWB._tryToTriggerDocumentReadyEvents()}())}}if(QQWB.browser.feature.localstorage){QQWB.extend("localStorage",{set:function(key,value,expireInDays){key="k"+key;var expire=QQWB.time.secondsNow()+(expireInDays||7)*24*3600,val={value:value,expire:expire};localStorage[key]=JSON.stringify(val);return localStorage[key]},get:function(key,defaultVal){key="k"+key;var temp=localStorage[key];if(temp&&(temp=JSON.parse(temp))&&temp.value&&QQWB.time.secondsNow()<temp.expire){return temp.value}return defaultVal},del:function(key){key="k"+key;localStorage.removeItem(key);return!!!localStorage[key]}})}else if(QQWB.browser.feature.userdata){var userData,storeName="QQWBLocalStore";QQWB.documentReady(function(){userData=document.createElement("input");userData.type="hidden";userData.style.display="none";userData.addBehavior("#default#userData");userData.expires=new Date(QQWB.time.now()+365*10*24*3600*1000).toUTCString();document.body.appendChild(userData)});QQWB.extend("store",{set:function(key,value,expireInDays){key="k"+key;var expire=QQWB.time.secondsNow()+(expireInDays||7)*24*3600,val={value:value,expire:expire};!userData&&QQWB.log.error("store can't set value for key "+key+", userData is unavaiable, please try later");userData&&userData.load(storeName);userData&&userData.setAttribute(key,JSON.stringify(val));userData&&userData.save(storeName);return userData.getAttribute(key)},get:function(key,defaultVal){key="k"+key;!userData&&QQWB.log.error("store can't get value for key "+key+", userData is unavaiable, please try later");userData&&userData.load(storeName);var temp=userData&&userData.getAttribute(key);if(temp&&(temp=JSON.parse(temp))&&temp.value&&QQWB.time.secondsNow()<temp.expire){return temp.value}return defaultVal},del:function(key){key="k"+key;!userData&&QQWB.log.error("store can't delete value for key "+key+", userData is unavaiable, please try later");userData&&userData.load(storeName);userData&&userData.removeAttribute(key);userData&&userData.save(storeName);return!!!userData.getAttribute(key)}})}else{QQWB.log.warning("T.localStorage object isn't initialized, do check before use")}if(QQWB.browser.feature.localstorage||QQWB.browser.feature.userdata){QQWB._alias.call(QQWB.localStorage,"save",QQWB.localStorage.set);QQWB._alias.call(QQWB.localStorage,"remove",QQWB.localStorage.del)}